!function(){"use strict";AFRAME.registerComponent("socailvr-toolbox-button",{dependencies:["is-remote-hover-target","hoverable-visuals"],schema:{type:"string",default:"Barge"},init:function(){const t=document.createElement("a-entity");t.setAttribute("text",`value: ${this.data.toUpperCase()}; align: center; color: black`),t.setAttribute("rotation","0 270 0"),t.setAttribute("position","0 0.4 0"),this.el.appendChild(t),this.onClick=this.onClick.bind(this),this.el.object3D.addEventListener("interact",this.onClick),this.barge=this.el.sceneEl.systems["socialvr-barge"].barge,NAF.connection.subscribeToDataChannel("createBarge",this.createBarge.bind(this)),NAF.connection.subscribeToDataChannel("removeBarge",this.removeBarge.bind(this))},remove:function(){this.el.object3D.removeEventListener("interact",this.onClick),NAF.connection.unsubscribeToDataChannel("createBarge"),NAF.connection.unsubscribeToDataChannel("removeBarge")},onClick:function(){this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playPositionalSoundFollowing(SOUND_SNAP_ROTATE,this.el.object3D),"Barge"===this.data&&(this.barge.getAttribute("visible")?(this.removeBarge(),NAF.connection.broadcastData("removeBarge",{})):(this.createBarge(),NAF.connection.broadcastData("createBarge",{}))),console.log(`Invalid social VR system ${this.data}`)},createBarge(){this.barge.setAttribute("visible",!0),this.barge.play()},removeBarge(){this.barge.emit("resetBargeEvent"),this.barge.setAttribute("visible",!1),this.barge.pause()}});let t=[],e=0;AFRAME.registerComponent("socialvr-barge",{schema:{width:{type:"number",default:4},height:{type:"number",default:1},depth:{type:"number",default:4},speed:{type:"number",default:1},moving:{type:"boolean",default:!1},targetKey:{type:"number",default:0}},init(){this.direction=new THREE.Vector3,loadModel(bargeModelSrc).then((t=>{console.log("[Social VR] Barge System - Mesh Loaded");const e=cloneObject3D(t.scene);e.scale.set(2,2,2),e.matrixNeedsUpdate=!0,this.el.setObject3D("mesh",e),this.el.object3D.scale.set(.5,.5,.5),this.el.object3D.matrixNeedsUpdate=!0}));const t=document.createElement("a-sphere");t.setAttribute("socialvr-barge-button","reset"),t.setAttribute("radius","0.15"),t.setAttribute("material","color: #3B56DC"),t.setAttribute("tags","singleActionButton: true"),t.setAttribute("css-class","interactable"),t.setAttribute("position",{x:this.el.object3D.position.x+1.8,y:this.el.object3D.position.y+1,z:this.el.object3D.position.z}),this.el.appendChild(t);const e=document.createElement("a-sphere");e.setAttribute("socialvr-barge-button","start"),e.setAttribute("radius","0.15"),e.setAttribute("material","color: #32CD32"),e.setAttribute("tags","singleActionButton: true"),e.setAttribute("css-class","interactable"),e.setAttribute("position",{x:this.el.object3D.position.x+1.8,y:this.el.object3D.position.y+1,z:this.el.object3D.position.z+1}),this.el.appendChild(e);const i=document.createElement("a-sphere");i.setAttribute("socialvr-barge-button","stop"),i.setAttribute("radius","0.15"),i.setAttribute("material","color: #FF0000"),i.setAttribute("tags","singleActionButton: true"),i.setAttribute("css-class","interactable"),i.setAttribute("position",{x:this.el.object3D.position.x+1.8,y:this.el.object3D.position.y+1,z:this.el.object3D.position.z-1}),this.el.appendChild(i);const s=document.querySelector(".BargeSpawn");s&&this.el.setAttribute("position",s.getAttribute("position")),this.el.addEventListener("startBargeEvent",this.startBarge.bind(this)),this.el.addEventListener("stopBargeEvent",this.stopBarge.bind(this)),this.el.addEventListener("resetBargeEvent",this.resetBarge.bind(this)),NAF.connection.subscribeToDataChannel("startBarge",this._startBarge.bind(this)),NAF.connection.subscribeToDataChannel("stopBarge",this._stopBarge.bind(this)),NAF.connection.subscribeToDataChannel("resetBarge",this._resetBarge.bind(this)),this.system.register(this.el)},remove(){this.el.removeEventListener("startBargeEvent",this.startBarge.bind(this)),this.el.removeEventListener("stopBargeEvent",this.stopBarge.bind(this)),this.el.removeEventListener("resetBargeEvent",this.resetBarge.bind(this)),NAF.connection.unsubscribeToDataChannel("startBarge"),NAF.connection.unsubscribeToDataChannel("stopBarge"),NAF.connection.unsubscribeToDataChannel("resetBarge"),this.el.removeObject3D("mesh"),this.system.unregister()},tick(i,s){this.el.getAttribute("visible")?this.el.play():this.el.pause();const o=this.el.object3D.position,n=o.x-this.data.width/2,a=o.x+this.data.width/2,r=o.z-this.data.depth/2,c=o.z+this.data.depth/2,l=window.APP.componentRegistry["player-info"][0],h=l.el.getAttribute("position"),b=this.el.sceneEl.systems["hubs-systems"].characterController;if(this.data.moving){const g=t[this.data.targetKey],u=this.direction;if(!g)return void(this.data.moving=!1);if(u.copy(g).sub(o),o.distanceToSquared(g)>=1){const t=this.data.speed/u.length();["x","y","z"].forEach((function(e){u[e]*=t*(s/1e3)})),this.el.setAttribute("position",{x:o.x+u.x,y:o.y+u.y,z:o.z+u.z}),h.x>=n&&h.x<=a&&h.z>=r&&h.z<=c?(b.barge=!0,l.el.setAttribute("position",{x:h.x+u.x,y:o.y-this.data.height/2+getCurrentPlayerHeight()/2,z:h.z+u.z})):b.barge=!1;document.querySelectorAll('[floaty-object=""]').forEach((t=>{const e=t.object3D.position.x,i=t.object3D.position.y,s=t.object3D.position.z;t.object3D.position.set(e+u.x,i-u.y,s+u.z)}));document.querySelectorAll('[interactable=""]').forEach((t=>{const e=t.object3D.position.x,i=t.object3D.position.y,s=t.object3D.position.z;t.object3D.position.set(e+u.x,i-u.y,s+u.z)}))}else h.x<n&&h.x>a&&h.z<r&&h.z>c&&(b.barge=!1),(isNaN(e)||i>=e)&&(e=i+100,this.data.targetKey=this.data.targetKey+1),console.log(this.data.targetKey)}else h.x>=n&&h.x<=a&&h.z>=r&&h.z<=c?(b.barge=!0,l.el.setAttribute("position",{x:h.x,y:o.y-this.data.height/2+getCurrentPlayerHeight()/2,z:h.z})):b.barge=!1},_startBarge(e,i,s,o){t=[];for(let e=1;e<100;e++){const i=document.querySelector(".Waypoint_"+e);i&&t.push(i.object3D.position)}t.length>=1?console.log(`Registered ${t.length} waypoints for the barge.`):(console.warn("No waypoints found!"),console.warn("Registering some default waypoints for the barge."),t.push(new Vector3(8.48,0,.67)),t.push(new Vector3(8.48,0,14.67)),t.push(new Vector3(-3.51,0,14.67)),t.push(new Vector3(-3.51,0,24.67))),console.log(t),this.data.moving=!0},_stopBarge(t,e,i,s){this.data.moving=!1},_resetBarge(t,e,i,s){const o=window.APP.componentRegistry["player-info"][0],n=o.el.getAttribute("position"),a=this.el.object3D.position.x-this.data.width/2,r=this.el.object3D.position.x+this.data.width/2,c=this.el.object3D.position.z-this.data.depth/2,l=this.el.object3D.position.z+this.data.depth/2;this.data.targetKey=0,this.data.moving=!1,this.el.setAttribute("position",{x:0,y:0,z:0}),n.x>=a&&n.x<=r&&n.z>=c&&n.z<=l&&o.el.setAttribute("position",{x:0,y:0,z:0})},startBarge(){this._startBarge(null,null,{}),NAF.connection.broadcastData("startBarge",{})},stopBarge(){this._stopBarge(null,null,{}),NAF.connection.broadcastData("stopBarge",{})},resetBarge(){this._resetBarge(null,null,{}),NAF.connection.broadcastData("resetBarge",{})}}),AFRAME.registerComponent("socialvr-barge-button",{dependencies:["is-remote-hover-target","hoverable-visuals"],schema:{type:"string",default:"start"},init:function(){const t=document.createElement("a-entity");t.setAttribute("text",`value: ${this.data.toUpperCase()}; align: center;`),t.setAttribute("rotation","0 270 0"),t.setAttribute("position","0 0.2 0"),this.el.appendChild(t),this.onClick=this.onClick.bind(this),this.el.object3D.addEventListener("interact",this.onClick)},remove:function(){this.el.object3D.removeEventListener("interact",this.onClick)},onClick:function(){this.el.emit(`${this.data}BargeEvent`),this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playPositionalSoundFollowing(SOUND_SNAP_ROTATE,this.el.object3D)}}),AFRAME.registerSystem("socialvr-barge",{init:function(){console.log("[Social VR] Barge System - Initialized"),this.barge=null},register:function(t){null!=this.barge&&this.el.removeChild(this.barge),this.barge=t},unregister:function(){this.barge=null}});const i=document.querySelector("a-scene");console.log("[Social VR] Barge - Create Barge");const[s,o]=CreateBarge();i.appendChild(s),i.appendChild(o),window.startPhaseTesting=function(){s.emit("advancePhaseEvent"),console.log("[Social VR] Barge - Current Phase: 1")}}();
//# sourceMappingURL=production.js.map
