!function(){"use strict";const e=5e3,t=[0,0,0],n=.05,o=3e5,s=.85/490,i=["book","jacket","pills","canteen","flashlight","compass","knife","mirror","newspaper","bottle","medic","map"],c=setInterval((function(e){if(!window.APP||!window.APP.scene)return;clearInterval(c),console.log("!!!initMaxAdditions!!!"),function(e,t){const n=setInterval((function(){e()&&clearInterval(n)}),t)}((function(){const e=document.querySelector("#environment-scene > a-entity > a-entity");if(!e)return;const t=e.className;return console.log("sceneName",t),t.includes("DSTTable")&&(console.log("Removing barge from scene due to sceneName:",t),document.querySelector("[socialvr-barge]").remove()),t.includes("BargeDemoWaypoints")&&(console.log("Disabling conversation balance viz due to sceneName:",t),r=!1),!0}),100),NAF.connection.subscribeToDataChannel("startSpeech",u),NAF.connection.subscribeToDataChannel("stopSpeech",d),setInterval(g,10);const t=setInterval((function(){const e=i.map((e=>document.querySelector(`.${e}`)));for(const t of e)t&&t.setAttribute("visible",!1)}),1e3);function n(e,t,n,o){console.log("disableSpawner",n);const s=document.querySelector(`.${n.itemName}`);s.setAttribute("visible",!1),s.object3D.position.y=-10}function o(){console.log("beginDST"),clearInterval(t);const e=i.map((e=>document.querySelector(`.${e}`)));for(const t of e)t&&(t.setAttribute("visible",!0),t.addEventListener("spawned-entity-created",(function(){const e=t.classList[0];console.log("spawned-entity-created",e);const o={itemName:e};n(0,0,o),NAF.connection.broadcastData("disableSpawner",o)})))}NAF.connection.subscribeToDataChannel("disableSpawner",n),window.beginDST=function(){o(),NAF.connection.broadcastData("beginDST",{})},NAF.connection.subscribeToDataChannel("beginDST",o),window.eventLog=[],window.logItemPositions=y,window.logEverything=function(){return y(),JSON.stringify(window.eventLog,null,2)}}),10);let r=!0;function a(e,t){t.eventType=e,t.timestamp=Date.now(),window.eventLog.push(t)}const l={};function u(e,s,i,c){if(console.log("startSpeech",e,s,i,c),a("startSpeech",i),!r)return;const u=l[i.speaker];u&&u.classList.add("finished");const d=(m=i.speaker,APP.componentRegistry["player-info"].find((e=>e.playerSessionId===m)));var m;const p=function(e,t){t=t||"yellow",console.log("spawnOrb",e,t);const n=document.createElement("a-entity");return n.classList.add("speechOrb"),n.setAttribute("geometry",{primitive:"cylinder",segmentsHeight:1,segmentsRadial:6,radius:.1,height:e}),n.setAttribute("material",`color:${t};shader:flat`),APP.scene.appendChild(n),setTimeout((()=>n.remove()),o),n}(n,function(e){const t={WUvZgGK:"lightskyblue",qpOOt9I:"hotpink","2s2UuzN":"red",wAUg76e:"limegreen",RczWQgy:"#222",xb4PVBE:"yellow",yw4c83R:"purple","4r1KpVk":"orange",bs7pLac:"darkblue"},n=e.data.avatarSrc;for(const e of Object.keys(t))if(n.includes(e))return t[e];return"#"+e.playerSessionId.substring(0,6)}(d));l[i.speaker]=p;const b=document.querySelector(".Table"),g=b?b.object3D.position.clone():new THREE.Vector3(...t);g.y=1.5;const f=d.el.object3D.position.clone();f.y=1.5;const y=(new THREE.Vector3).subVectors(f,g).normalize(),h=(new THREE.Vector3).addVectors(g,y);p.setAttribute("position",h)}function d(e,t,n,o){console.log("stopSpeech",e,t,n,o),a("stopSpeech",n);const s=l[n.speaker];s&&(s.setAttribute("geometry",{primitive:"cylinder",segmentsHeight:1,segmentsRadial:6,radius:.1,height:n.size}),s.classList.add("finished"),delete l[n.speaker])}let m=0,p=0;function b(t){const o=(t-(s=100))/(e-s)*(.9-(i=n))+i;var s,i;const c=APP.componentRegistry["player-info"][0],r={size:o,speaker:c.playerSessionId,speakerName:c.displayName};d(null,null,r),NAF.connection.broadcastData("stopSpeech",r)}function g(){const t=APP.componentRegistry["player-info"][0],n=t.data.muted,o=window.APP.scene.systems["local-audio-analyser"];if(!n&&o.volume>1e-5){if(0===m){const e={speaker:t.playerSessionId,speakerName:t.displayName};u(null,null,e),NAF.connection.broadcastData("startSpeech",e)}m+=10,p=100,m>=e&&(b(m),m=0)}else p>0&&(p-=10),p<=0&&m>=100&&(b(m),m=0);for(const e of document.querySelectorAll(".speechOrb.finished")){const t=e.getAttribute("position");t.y+=s,e.setAttribute("position",t)}for(const e of Object.values(l)){const t=e.getAttribute("geometry").height+s;e.setAttribute("geometry",{primitive:"cylinder",segmentsHeight:1,segmentsRadial:6,radius:.1,height:t});const n=e.getAttribute("position");n.y+=.0008673469387755102,e.setAttribute("position",n)}}function f(e){const t=[{x:0,z:-.85,cellNum:1},{x:0,z:-.71,cellNum:2},{x:0,z:-.575,cellNum:3},{x:0,z:-.45,cellNum:4},{x:0,z:-.31,cellNum:5},{x:0,z:-.17,cellNum:6},{x:0,z:-.04,cellNum:7},{x:0,z:.09,cellNum:8},{x:0,z:.23,cellNum:9},{x:0,z:.365,cellNum:10},{x:0,z:.5,cellNum:11},{x:0,z:.635,cellNum:12}];return t.sort(((t,n)=>{const o=new THREE.Vector3(t.x,0,t.z),s=new THREE.Vector3(n.x,0,n.z);return e.distanceToSquared(o)-e.distanceToSquared(s)})),t[0]}function y(){const e={itemRanks:{},itemPositions:{}},t=function(){const e={};for(const t of i)e[document.querySelector(`.${t}`).components["gltf-model-plus"].data.src]=t;return e}(),n=[...document.querySelectorAll(".interactable > .ui.interactable-ui")].map((e=>e.parentNode));for(const o of n){const n=o.components["gltf-model-plus"];if(!n)continue;const s=t[n.data.src];if(!s)continue;const i=o.object3D.position,c=f(i);e.itemRanks[s]=c.cellNum,e.itemPositions[s]={x:i.x,z:i.z}}return a("itemPositions",e),e}}();
//# sourceMappingURL=production.js.map
