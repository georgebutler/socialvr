!function(){"use strict";var t={};AFRAME.registerComponent("socailvr-toolbox-button",{dependencies:["is-remote-hover-target","hoverable-visuals"],schema:{type:"string",default:"Barge"},init:function(){const t=document.createElement("a-entity");t.setAttribute("text",`value: ${this.data.toUpperCase()}; align: center; color: black`),t.setAttribute("rotation","0 270 0"),t.setAttribute("position","0 0.4 0"),this.el.appendChild(t),this.onClick=this.onClick.bind(this),this.el.object3D.addEventListener("interact",this.onClick),this.barge=this.el.sceneEl.systems["socialvr-barge"].barge,NAF.connection.subscribeToDataChannel("createBarge",this.createBarge.bind(this)),NAF.connection.subscribeToDataChannel("removeBarge",this.removeBarge.bind(this))},remove:function(){this.el.object3D.removeEventListener("interact",this.onClick),NAF.connection.unsubscribeToDataChannel("createBarge"),NAF.connection.unsubscribeToDataChannel("removeBarge")},onClick:function(){this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playPositionalSoundFollowing(SOUND_SNAP_ROTATE,this.el.object3D),"Barge"===this.data&&(this.barge.getAttribute("visible")?(this.removeBarge(),NAF.connection.broadcastData("removeBarge",{})):(this.createBarge(),NAF.connection.broadcastData("createBarge",{}))),console.log(`Invalid social VR system ${this.data}`)},createBarge(){this.barge.setAttribute("visible",!0),this.barge.play()},removeBarge(){this.barge.emit("resetBargeEvent"),this.barge.setAttribute("visible",!1),this.barge.pause()}});let e=[],i=0;function s(t){console.log("[Social VR] Barge - Phase Initialized");const e=document.querySelector(".phase-1");e?(console.log("[Social VR] Barge - Phase 1 Found"),e.children.forEach((e=>{e.setAttribute("visible",t)}))):console.warn("[Social VR] Barge - Phase 1 Not Found")}AFRAME.registerComponent("socialvr-barge",{schema:{width:{type:"number",default:4},height:{type:"number",default:1},depth:{type:"number",default:4},speed:{type:"number",default:1},moving:{type:"boolean",default:!1},targetKey:{type:"number",default:0}},init(){this.direction=new THREE.Vector3,window.APP.utils.GLTFModelPlus.loadModel(t).then((t=>{console.log("[Social VR] Barge System - Mesh Loaded");const e=cloneObject3D(t.scene);e.scale.set(2,2,2),e.matrixNeedsUpdate=!0,this.el.setObject3D("mesh",e),this.el.object3D.scale.set(.5,.5,.5),this.el.object3D.matrixNeedsUpdate=!0}));const e=document.createElement("a-sphere");e.setAttribute("socialvr-barge-button","reset"),e.setAttribute("radius","0.15"),e.setAttribute("material","color: #3B56DC"),e.setAttribute("tags","singleActionButton: true"),e.setAttribute("css-class","interactable"),e.setAttribute("position",{x:this.el.object3D.position.x+1.8,y:this.el.object3D.position.y+1,z:this.el.object3D.position.z}),this.el.appendChild(e);const i=document.createElement("a-sphere");i.setAttribute("socialvr-barge-button","start"),i.setAttribute("radius","0.15"),i.setAttribute("material","color: #32CD32"),i.setAttribute("tags","singleActionButton: true"),i.setAttribute("css-class","interactable"),i.setAttribute("position",{x:this.el.object3D.position.x+1.8,y:this.el.object3D.position.y+1,z:this.el.object3D.position.z+1}),this.el.appendChild(i);const s=document.createElement("a-sphere");s.setAttribute("socialvr-barge-button","stop"),s.setAttribute("radius","0.15"),s.setAttribute("material","color: #FF0000"),s.setAttribute("tags","singleActionButton: true"),s.setAttribute("css-class","interactable"),s.setAttribute("position",{x:this.el.object3D.position.x+1.8,y:this.el.object3D.position.y+1,z:this.el.object3D.position.z-1}),this.el.appendChild(s);const o=document.querySelector(".BargeSpawn");o&&this.el.setAttribute("position",o.getAttribute("position")),this.el.addEventListener("startBargeEvent",this.startBarge.bind(this)),this.el.addEventListener("stopBargeEvent",this.stopBarge.bind(this)),this.el.addEventListener("resetBargeEvent",this.resetBarge.bind(this)),NAF.connection.subscribeToDataChannel("startBarge",this._startBarge.bind(this)),NAF.connection.subscribeToDataChannel("stopBarge",this._stopBarge.bind(this)),NAF.connection.subscribeToDataChannel("resetBarge",this._resetBarge.bind(this)),this.system.register(this.el)},remove(){this.el.removeEventListener("startBargeEvent",this.startBarge.bind(this)),this.el.removeEventListener("stopBargeEvent",this.stopBarge.bind(this)),this.el.removeEventListener("resetBargeEvent",this.resetBarge.bind(this)),NAF.connection.unsubscribeToDataChannel("startBarge"),NAF.connection.unsubscribeToDataChannel("stopBarge"),NAF.connection.unsubscribeToDataChannel("resetBarge"),this.el.removeObject3D("mesh"),this.system.unregister()},tick(t,s){this.el.getAttribute("visible")?this.el.play():this.el.pause();const o=this.el.object3D.position,n=o.x-this.data.width/2,a=o.x+this.data.width/2,r=o.z-this.data.depth/2,c=o.z+this.data.depth/2,l=window.APP.componentRegistry["player-info"][0],h=l.el.getAttribute("position"),b=this.el.sceneEl.systems["hubs-systems"].characterController;if(this.data.moving){const u=e[this.data.targetKey],g=this.direction;if(!u)return void(this.data.moving=!1);if(g.copy(u).sub(o),o.distanceToSquared(u)>=1){const t=this.data.speed/g.length();["x","y","z"].forEach((function(e){g[e]*=t*(s/1e3)})),this.el.setAttribute("position",{x:o.x+g.x,y:o.y+g.y,z:o.z+g.z}),h.x>=n&&h.x<=a&&h.z>=r&&h.z<=c?(b.barge=!0,l.el.setAttribute("position",{x:h.x+g.x,y:o.y-this.data.height/2+window.APP.utils.getCurrentPlayerHeight()/2,z:h.z+g.z})):b.barge=!1;document.querySelectorAll('[floaty-object=""]').forEach((t=>{const e=t.object3D.position.x,i=t.object3D.position.y,s=t.object3D.position.z;t.object3D.position.set(e+g.x,i-g.y,s+g.z)}));document.querySelectorAll('[interactable=""]').forEach((t=>{const e=t.object3D.position.x,i=t.object3D.position.y,s=t.object3D.position.z;t.object3D.position.set(e+g.x,i-g.y,s+g.z)}))}else h.x<n&&h.x>a&&h.z<r&&h.z>c&&(b.barge=!1),(isNaN(i)||t>=i)&&(i=t+100,this.data.targetKey=this.data.targetKey+1),console.log(this.data.targetKey)}else h.x>=n&&h.x<=a&&h.z>=r&&h.z<=c?(b.barge=!0,l.el.setAttribute("position",{x:h.x,y:o.y-this.data.height/2+window.APP.utils.getCurrentPlayerHeight()/2,z:h.z})):b.barge=!1},_startBarge(t,i,s,o){e=[];for(let t=1;t<100;t++){const i=document.querySelector(".Waypoint_"+t);i&&e.push(i.object3D.position)}e.length>=1?console.log(`Registered ${e.length} waypoints for the barge.`):(console.warn("No waypoints found!"),console.warn("Registering some default waypoints for the barge."),e.push(new Vector3(8.48,0,.67)),e.push(new Vector3(8.48,0,14.67)),e.push(new Vector3(-3.51,0,14.67)),e.push(new Vector3(-3.51,0,24.67))),console.log(e),this.data.moving=!0},_stopBarge(t,e,i,s){this.data.moving=!1},_resetBarge(t,e,i,s){const o=window.APP.componentRegistry["player-info"][0],n=o.el.getAttribute("position"),a=this.el.object3D.position.x-this.data.width/2,r=this.el.object3D.position.x+this.data.width/2,c=this.el.object3D.position.z-this.data.depth/2,l=this.el.object3D.position.z+this.data.depth/2;this.data.targetKey=0,this.data.moving=!1,this.el.setAttribute("position",{x:0,y:0,z:0}),n.x>=a&&n.x<=r&&n.z>=c&&n.z<=l&&o.el.setAttribute("position",{x:0,y:0,z:0})},startBarge(){this._startBarge(null,null,{}),NAF.connection.broadcastData("startBarge",{})},stopBarge(){this._stopBarge(null,null,{}),NAF.connection.broadcastData("stopBarge",{})},resetBarge(){this._resetBarge(null,null,{}),NAF.connection.broadcastData("resetBarge",{})}}),AFRAME.registerComponent("socialvr-barge-button",{dependencies:["is-remote-hover-target","hoverable-visuals"],schema:{type:"string",default:"start"},init:function(){const t=document.createElement("a-entity");t.setAttribute("text",`value: ${this.data.toUpperCase()}; align: center;`),t.setAttribute("rotation","0 270 0"),t.setAttribute("position","0 0.2 0"),this.el.appendChild(t),this.onClick=this.onClick.bind(this),this.el.object3D.addEventListener("interact",this.onClick)},remove:function(){this.el.object3D.removeEventListener("interact",this.onClick)},onClick:function(){this.el.emit(`${this.data}BargeEvent`),this.el.sceneEl.systems["hubs-systems"].soundEffectsSystem.playPositionalSoundFollowing(SOUND_SNAP_ROTATE,this.el.object3D)}}),AFRAME.registerSystem("socialvr-barge",{init:function(){console.log("[Social VR] Barge System - Initialized"),this.barge=null},register:function(t){null!=this.barge&&this.el.removeChild(this.barge),this.barge=t},unregister:function(){this.barge=null}});const o=document.querySelector("a-scene"),[n,a]=function(){const t=document.createElement("a-entity");t.setAttribute("socialvr-barge",""),t.setAttribute("visible",!0);const e=document.createElement("a-sphere");return e.setAttribute("socailvr-toolbox-button","Barge"),e.setAttribute("radius","0.3"),e.setAttribute("material","color: pink"),e.setAttribute("tags","singleActionButton: true"),e.setAttribute("css-class","interactable"),e.setAttribute("position",{x:5,y:2,z:3}),s(!1),t.addEventListener("advancePhaseEvent",(function(){s(!0),NAF.connection.broadcastData("advancePhase",{})})),NAF.connection.subscribeToDataChannel("advancePhase",s(!0)),[t,e]}();o.appendChild(n),o.appendChild(a),console.log("[Social VR] Barge - Create Barge")}();
//# sourceMappingURL=production.js.map
